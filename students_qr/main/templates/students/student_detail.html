<!-- templates/students/student_detail.html -->
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü—Ä–æ—Ñ–∏–ª—å —Å—Ç—É–¥–µ–Ω—Ç–∞ - {{ student.full_name_english }}</title>
    {% load static %}
    <link rel="stylesheet" href="{% static 'students/css/style.css' %}">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <h1>{% block header_title %}–°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å—Ç—É–¥–µ–Ω—Ç–∞–º–∏{% endblock %}</h1>
            
            <div class="auth-info">
                {% if user.is_authenticated %}
                    <span class="user-greeting">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, {{ user.username }}!</span>
                    <form method="post" action="{% url 'students:logout' %}" style="display: inline;">
                        {% csrf_token %}
                        <button type="submit" class="btn-logout">–í—ã–π—Ç–∏</button>
                    </form>
                {% else %}
                    <a href="{% url 'students:login' %}" class="btn-login">–í–æ–π—Ç–∏</a>
                {% endif %}
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        <!-- –ö–Ω–æ–ø–∫–∞ –Ω–∞–∑–∞–¥ -->
        <div class="back-button">
            <a href="{% url 'students:student_list' %}" class="btn btn-secondary">‚Üê –ù–∞–∑–∞–¥ –∫ —Å–ø–∏—Å–∫—É</a>
        </div>

        <!-- –ë–ª–æ–∫ 1: –ü–æ–ª–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å—Ç—É–¥–µ–Ω—Ç–µ -->
        <section class="student-info-section">
            <h2 class="section-title">–û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h2>
            <div class="student-info-grid">
                <div class="info-group">
                    <h3>–õ–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</h3>
                    <div class="info-item">
                        <span class="info-label">–§–ò–û (–∞–Ω–≥–ª–∏–π—Å–∫–∏–π):</span>
                        <span class="info-value">{{ student.full_name_english }}</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">–§–ò–û (–∞—Ä–∞–±—Å–∫–∏–π):</span>
                        <span class="info-value">{{ student.full_name_arabic }}</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">–ù–æ–º–µ—Ä –ø–∞—Å–ø–æ—Ä—Ç–∞:</span>
                        <span class="info-value">{{ student.passport_number }}</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è:</span>
                        <span class="info-value">{{ student.birth_date|date:"d.m.Y" }}</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">–ü–æ–ª:</span>
                        <span class="info-value">{{ student.get_gender_display }}</span>
                    </div>
                </div>

                <div class="info-group">
                    <h3>–ì—Ä–∞–∂–¥–∞–Ω—Å—Ç–≤–æ –∏ –ø—Ä–æ–∂–∏–≤–∞–Ω–∏–µ</h3>
                    <div class="info-item">
                        <span class="info-label">–ì—Ä–∞–∂–¥–∞–Ω—Å—Ç–≤–æ:</span>
                        <span class="info-value">{{ student.citizenship }}</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">–°—Ç—Ä–∞–Ω–∞ –ø—Ä–æ–∂–∏–≤–∞–Ω–∏—è:</span>
                        <span class="info-value">{{ student.country_of_residence }}</span>
                    </div>
                </div>

                <div class="info-group">
                    <h3>–û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ</h3>
                    <div class="info-item">
                        <span class="info-label">–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏:</span>
                        <span class="info-value">{{ student.major }}</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">–°—Ä–æ–∫ –æ–±—É—á–µ–Ω–∏—è:</span>
                        <span class="info-value">{{ student.study_duration }} –ª–µ—Ç</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">–°—Ç–∞—Ç—É—Å:</span>
                        <span class="info-value status-{{ student.current_status }}">
                            {{ student.get_current_status_display }}
                        </span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞ –æ–±—É—á–µ–Ω–∏—è:</span>
                        <span class="info-value">{{ student.start_date|date:"d.m.Y" }}</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">–ü—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ–º–∞—è –¥–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è:</span>
                        <span class="info-value">{{ student.expected_end_date|date:"d.m.Y" }}</span>
                    </div>
                    {% if student.actual_end_date %}
                    <div class="info-item">
                        <span class="info-label">–§–∞–∫—Ç–∏—á–µ—Å–∫–∞—è –¥–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è:</span>
                        <span class="info-value">{{ student.actual_end_date|date:"d.m.Y" }}</span>
                    </div>
                    {% endif %}
                </div>

                <div class="info-group">
                    <h3>–ö–æ–Ω—Ç–∞–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</h3>
                    <div class="info-item">
                        <span class="info-label">–¢–µ–ª–µ—Ñ–æ–Ω:</span>
                        <span class="info-value">{{ student.phone_number }}</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Email:</span>
                        <span class="info-value">{{ student.email }}</span>
                    </div>
                </div>

                <div class="info-group">
                    <h3>–£–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç—ã</h3>
                    {% for university in student.universities.all %}
                    <div class="info-item">
                        <span class="info-label">–£–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç:</span>
                        <span class="info-value">{{ university.university }}</span>
                    </div>
                    {% empty %}
                    <div class="info-item">
                        <span class="info-value">–£–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç—ã –Ω–µ —É–∫–∞–∑–∞–Ω—ã</span>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </section>

        <!-- –ë–ª–æ–∫ 2 –∏ 3: –ö–Ω–æ–ø–∫–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ -->
        <!-- –í student_detail.html –∑–∞–º–µ–Ω–∏—Ç–µ actions-section –Ω–∞: -->
        <section class="documents-section">
            <h2 class="section-title">–î–æ–∫—É–º–µ–Ω—Ç—ã —Å—Ç—É–¥–µ–Ω—Ç–∞</h2>
            
            <!-- –ö–Ω–æ–ø–∫–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è -->
                <!-- –ö–Ω–æ–ø–∫–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è (—Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤) -->
            {% if is_admin or is_superuser %}
            <div class="action-buttons" style="margin-bottom: 2rem;">
                <div class="action-button-group">
                    <a href="{% url 'students:add_certificate' student.id %}" class="btn btn-primary btn-large">
                        üìÑ –î–æ–±–∞–≤–∏—Ç—å —Å–ø—Ä–∞–≤–∫—É
                    </a>
                    <p class="action-description">–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é —Å–ø—Ä–∞–≤–∫—É –¥–ª—è —Å—Ç—É–¥–µ–Ω—Ç–∞</p>
                </div>

                <div class="action-button-group">
                    <a href="{% url 'students:add_diploma' student.id %}" class="btn btn-primary btn-large">
                        üéì –î–æ–±–∞–≤–∏—Ç—å –¥–∏–ø–ª–æ–º
                    </a>
                    <p class="action-description">–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –¥–∏–ø–ª–æ–º –¥–ª—è —Å—Ç—É–¥–µ–Ω—Ç–∞</p>
                </div>
            </div>
            {% endif %}

            <!-- –°–ø–∏—Å–æ–∫ —Å–ø—Ä–∞–≤–æ–∫ -->
            {% if certificates %}
            <h3 style="color: #2c3e50; margin-bottom: 1rem;">–°–ø—Ä–∞–≤–∫–∏</h3>
            <div class="documents-grid">
                {% for certificate in certificates %}
                <div class="document-card">
                    <div class="document-header">
                        <h4 class="document-title">–°–ø—Ä–∞–≤–∫–∞ ‚Ññ{{ certificate.certificate_number }}</h4>
                        <span class="document-type">{{ certificate.get_certificate_type_display }}</span>
                    </div>
                    <div class="document-info">
                        <div class="document-info-item">
                            <span class="document-info-label">–¢–∏–ø:</span>
                            <span class="document-info-value">{{ certificate.get_certificate_type_display }}</span>
                        </div>
                        <div class="document-info-item">
                            <span class="document-info-label">–î–∞—Ç–∞ –≤—ã–¥–∞—á–∏:</span>
                            <span class="document-info-value">{{ certificate.issue_date|date:"d.m.Y" }}</span>
                        </div>
                        <div class="document-info-item">
                            <span class="document-info-label">–£—á—Ä–µ–∂–¥–µ–Ω–∏–µ:</span>
                            <span class="document-info-value">{{ certificate.issuing_institution }}</span>
                        </div>
                        <div class="document-info-item">
                            <span class="document-info-label">–¶–µ–ª—å:</span>
                            <span class="document-info-value">{{ certificate.get_purpose_display }}</span>
                        </div>
                    </div>
                    <div class="document-actions">
                        <a href="{% url 'students:certificate_detail' student.id certificate.id %}" class="btn btn-view">
                            üëÅÔ∏è –û—Ç–∫—Ä—ã—Ç—å
                        </a>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% endif %}

            <!-- –°–ø–∏—Å–æ–∫ –¥–∏–ø–ª–æ–º–æ–≤ -->
            {% if diplomas %}
            <h3 style="color: #2c3e50; margin-bottom: 1rem; margin-top: 2rem;">–î–∏–ø–ª–æ–º—ã</h3>
            <div class="documents-grid">
                {% for diploma in diplomas %}
                <div class="document-card">
                    <div class="document-header">
                        <h4 class="document-title">–î–∏–ø–ª–æ–º ‚Ññ{{ diploma.diploma_number }}</h4>
                        <span class="document-type">{{ diploma.get_diploma_type_display }}</span>
                    </div>
                    <div class="document-info">
                        <div class="document-info-item">
                            <span class="document-info-label">–¢–∏–ø:</span>
                            <span class="document-info-value">{{ diploma.get_diploma_type_display }}</span>
                        </div>
                        <div class="document-info-item">
                            <span class="document-info-label">–°–µ—Ä–∏—è:</span>
                            <span class="document-info-value">{{ diploma.diploma_series }}</span>
                        </div>
                        <div class="document-info-item">
                            <span class="document-info-label">–î–∞—Ç–∞ –≤—ã–¥–∞—á–∏:</span>
                            <span class="document-info-value">{{ diploma.issue_date|date:"d.m.Y" }}</span>
                        </div>
                        <div class="document-info-item">
                            <span class="document-info-label">–£—Ä–æ–≤–µ–Ω—å:</span>
                            <span class="document-info-value">{{ diploma.get_education_level_display }}</span>
                        </div>
                        <div class="document-info-item">
                            <span class="document-info-label">–°—Ç–∞—Ç—É—Å:</span>
                            <span class="document-info-value status-{{ diploma.document_status }}">
                                {{ diploma.get_document_status_display }}
                            </span>
                        </div>
                    </div>
                    <div class="document-actions">
                        <a href="{% url 'students:diploma_detail' student.id diploma.id %}" class="btn btn-view">
                            üëÅÔ∏è –û—Ç–∫—Ä—ã—Ç—å
                        </a>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% endif %}

            {% if not certificates and not diplomas %}
            <div class="empty-state" style="text-align: center; padding: 3rem; color: #7f8c8d;">
                <p>–ù–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤</p>
            </div>
            {% endif %}
        </section>

        <section class="document-detail-section">
            <h2 class="section-title">–ß–µ–∫ –æ–ø–ª–∞—Ç—ã #{{ receipt.id }}</h2>
    
            <div class="document-info-grid">
                <div class="info-group">
                    <h3>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —á–µ–∫–µ</h3>
                    <div class="info-item">
                        <span class="info-label">ID —á–µ–∫–∞:</span>
                        <span class="info-value">#{{ receipt.id }}</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">–°—Ç—É–¥–µ–Ω—Ç:</span>
                        <span class="info-value">{{ student.full_name_english }}</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">–î–∞—Ç–∞ –∑–∞–≥—Ä—É–∑–∫–∏:</span>
                        <span class="info-value">{{ receipt.upload_date|date:"d.m.Y H:i" }}</span>
                    </div>
                </div>
            </div>

            <!-- –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —á–µ–∫–∞ -->
            <div class="document-scan-section">
                <h3 class="section-title">–ß–µ–∫ –æ–ø–ª–∞—Ç—ã</h3>
                
                {% if receipt.payment_receipt %}
                    <div class="scan-container">
                        {% if receipt.payment_receipt.url|lower|slice:'-4:' == '.pdf' %}
                            <!-- –î–ª—è PDF —Ñ–∞–π–ª–æ–≤ -->
                            <div class="pdf-viewer">
                                <iframe src="{{ receipt.payment_receipt.url }}" 
                                        width="100%" 
                                        height="600px" 
                                        style="border: 1px solid #ddd; border-radius: 8px;">
                                    –í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ø—Ä–æ—Å–º–æ—Ç—Ä PDF. 
                                    <a href="{{ receipt.payment_receipt.url }}" download>–°–∫–∞—á–∞–π—Ç–µ —Ñ–∞–π–ª</a>
                                </iframe>
                                <div class="scan-actions">
                                    <a href="{{ receipt.payment_receipt.url }}" 
                                    download 
                                    class="btn btn-download">
                                        üì• –°–∫–∞—á–∞—Ç—å PDF
                                    </a>
                                </div>
                            </div>
                        {% else %}
                            <!-- –î–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π -->
                            <div class="image-viewer">
                                <img src="{{ receipt.payment_receipt.url }}" 
                                    alt="–ß–µ–∫ –æ–ø–ª–∞—Ç—ã #{{ receipt.id }}"
                                    class="scan-image">
                                <div class="scan-actions">
                                    <a href="{{ receipt.payment_receipt.url }}" 
                                    download 
                                    class="btn btn-download">
                                        üì• –°–∫–∞—á–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
                                    </a>
                                    <button onclick="zoomImage()" class="btn btn-primary">
                                        üîç –£–≤–µ–ª–∏—á–∏—Ç—å
                                    </button>
                                </div>
                            </div>
                        {% endif %}
                    </div>
                {% else %}
                    <div class="no-scan">
                        <p>–§–∞–π–ª —á–µ–∫–∞ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω</p>
                    </div>
                {% endif %}
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-content">
            <div class="organization-info">
                <h3>–ú–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω—ã–π –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã–π —Ü–µ–Ω—Ç—Ä</h3>
                <p>–ê–¥—Ä–µ—Å: –≥. –ú–æ—Å–∫–≤–∞, —É–ª. –°—Ç—É–¥–µ–Ω—á–µ—Å–∫–∞—è, –¥. 15</p>
                <p>–¢–µ–ª–µ—Ñ–æ–Ω: +7 (495) 123-45-67</p>
                <p>Email: info@edu-center.ru</p>
                <p>&copy; 2025 –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã</p>
            </div>
        </div>
    </footer>

    <script>
        function addCertificate() {
            alert('–§—É–Ω–∫—Ü–∏—è "–î–æ–±–∞–≤–∏—Ç—å —Å–ø—Ä–∞–≤–∫—É" –±—É–¥–µ—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –ø–æ–∑–∂–µ');
        }

        function addDiploma() {
            alert('–§—É–Ω–∫—Ü–∏—è "–î–æ–±–∞–≤–∏—Ç—å –¥–∏–ø–ª–æ–º" –±—É–¥–µ—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –ø–æ–∑–∂–µ');
        }
    </script>
</body>
</html>